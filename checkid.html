<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trình giải mã liên kết</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 2em;
            background-color: #f4f4f9;
            color: #333;
        }
        .container {
            max-width: 600px;
            margin: auto;
            padding: 2em;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #0056b3;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 1em;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #0056b3;
        }
        #results {
            margin-top: 1.5em;
            padding: 1em;
            background-color: #e9ecef;
            border: 1px solid #ced4da;
            border-radius: 4px;
            word-wrap: break-word;
        }
        #full-link-title, #affiliate-id-title {
            font-weight: bold;
            color: #343a40;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Giải mã liên kết rút gọn</h1>
        <p>Dán một liên kết rút gọn vào ô bên dưới và nhấn "Giải mã" để xem liên kết đầy đủ và ID affiliate (nếu có).</p>
        
        <input type="text" id="short-url" placeholder="Dán liên kết rút gọn vào đây (ví dụ: bit.ly/...)">
        <button onclick="unshortenUrl()">Giải mã</button>

        <div id="results" style="display:none;">
            <p id="full-link-title">Liên kết đầy đủ:</p>
            <p id="full-link"></p>
            <p id="affiliate-id-title">ID Affiliate (tham số trong URL):</p>
            <p id="affiliate-id">Không tìm thấy.</p>
        </div>
    </div>

    <script>
        function unshortenUrl() {
            const shortUrl = document.getElementById('short-url').value;
            if (!shortUrl) {
                alert('Vui lòng nhập một liên kết rút gọn.');
                return;
            }

            // Sử dụng API của unshorten.it (lưu ý rằng API này có thể không ổn định)
            // Chúng ta sẽ sử dụng một proxy CORS để tránh lỗi trình duyệt
            const apiUrl = `https://api.allorigins.win/raw?url=http://api.unshorten.it/simple/${encodeURIComponent(shortUrl)}`;

            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Không thể kết nối đến dịch vụ giải mã.');
                    }
                    return response.text();
                })
                .then(fullUrl => {
                    document.getElementById('full-link').textContent = fullUrl;
                    
                    // Cố gắng tìm ID affiliate trong các tham số của URL
                    try {
                        const urlParams = new URL(fullUrl).searchParams;
                        let affiliateId = "Không tìm thấy tham số affiliate phổ biến.";
                        
                        // Các tham số affiliate phổ biến
                        const affParams = ['affid', 'aff_id', 'affiliate_id', 'ref', 'referral', 'tag'];
                        
                        for (const param of affParams) {
                            if (urlParams.has(param)) {
                                affiliateId = `Tìm thấy tham số '${param}': ${urlParams.get(param)}`;
                                break;
                            }
                        }
                        document.getElementById('affiliate-id').textContent = affiliateId;

                    } catch (e) {
                        document.getElementById('affiliate-id').textContent = 'Không thể phân tích URL để tìm ID affiliate.';
                    }

                    document.getElementById('results').style.display = 'block';
                })
                .catch(error => {
                    alert('Đã xảy ra lỗi: ' + error.message);
                });
        }
    </script>

</body>
</html>
