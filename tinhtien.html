<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Công Cụ Chèn TimeMark - Tinh Chỉnh Font</title>
    <style>
        /* CSS tương tự như trước */
        body { font-family: 'Arial', sans-serif; padding: 20px; background-color: #f4f4f4; display: flex; flex-direction: column; align-items: center; }
        .controls { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); margin-bottom: 20px; width: 100%; max-width: 600px; }
        .controls label { display: block; margin-top: 10px; font-weight: bold; }
        .controls input[type="text"] { width: calc(100% - 10px); padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; }
        .controls button { margin-top: 20px; padding: 10px 15px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; transition: background-color 0.3s; }
        .controls button:hover { background-color: #0056b3; }
        .image-display { width: 100%; max-width: 400px; text-align: center; border: 1px dashed #ccc; background-color: #fff; padding: 10px; border-radius: 8px; }
        #output-canvas { display: none; max-width: 100%; height: auto; border: 1px solid #ddd; }
        #placeholder { width: 100%; height: 300px; line-height: 300px; color: #aaa; font-size: 1.2em; }
        #download-link { display: none; margin-top: 10px; padding: 10px 15px; background-color: #28a745; color: white; border: none; border-radius: 4px; text-decoration: none; transition: background-color 0.3s; }
    </style>
</head>
<body>

    <h1>Công Cụ Chèn TimeMark - Tinh Chỉnh</h1>

    <div class="controls">
        <input type="file" id="image-file-input" accept="image/*">
        
        <label for="input-time">Thời gian (VD: 12:26):</label>
        <input type="text" id="input-time" value="12:26">

        <label for="input-date">Ngày (VD: 01 Oct, 2025):</label>
        <input type="text" id="input-date" value="01 Oct, 2025">

        <label for="input-day">Thứ (VD: Wed):</label>
        <input type="text" id="input-day" value="Wed">

        <label for="input-address">Địa chỉ (Góc dưới trái):</label>
        <input type="text" id="input-address" value="ĐT. 356, Đông Hải 2, Hải An, Hải Phòng">

        <button id="process-button">Chèn Thông tin và Xem Ảnh (1920x2560)</button>
        <a id="download-link" href="#" download="timemark_final.png">Tải Ảnh Đã Chèn Về (PNG)</a>
    </div>

    <div class="image-display">
        <canvas id="output-canvas"></canvas>
        <div id="placeholder">Tải ảnh lên để bắt đầu</div>
    </div>


    <script>
        const fileInput = document.getElementById('image-file-input');
        const canvas = document.getElementById('output-canvas');
        const ctx = canvas.getContext('2d');
        const placeholder = document.getElementById('placeholder');
        const processButton = document.getElementById('process-button');
        const downloadLink = document.getElementById('download-link');
        
        let originalImage = null;
        
        // Kích thước chuẩn hóa
        const TARGET_WIDTH = 1920;
        const TARGET_HEIGHT = 2560;

        // Bắt sự kiện tải file
        fileInput.addEventListener('change', (event) => {
            // ... (Phần tải file và resize không thay đổi) ...
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    originalImage = new Image();
                    originalImage.onload = () => {
                        canvas.width = TARGET_WIDTH;
                        canvas.height = TARGET_HEIGHT;
                        placeholder.style.display = 'none';
                        canvas.style.display = 'block';
                        processButton.disabled = false;
                        drawCanvas();
                    };
                    originalImage.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // Xử lý nút Chèn
        processButton.addEventListener('click', drawCanvas);

        function drawCanvas() {
            if (!originalImage) return;

            // 1. Vẽ lại ảnh gốc (resize) lên canvas
            ctx.drawImage(originalImage, 0, 0, TARGET_WIDTH, TARGET_HEIGHT);

            // 2. Lấy dữ liệu từ ô nhập
            const timePart = document.getElementById('input-time').value.trim() || "12:26";
            const datePart = document.getElementById('input-date').value.trim() || "01 Oct, 2025";
            const dayPart = document.getElementById('input-day').value.trim() || "Wed";
            const addressText = document.getElementById('input-address').value.trim() || "Địa chỉ";
            
            const logoTextLine1 = "TimeMark";
            const logoTextLine2 = "100% Chân thực";

            // --- CÀI ĐẶT THÔNG SỐ VẼ (Dựa trên kích thước 1920x2560) ---
            const PADDING_X = 70;  // Khoảng đệm từ lề trái/phải
            const PADDING_BOTTOM = 70; // Khoảng đệm từ lề dưới
            
            // Cài đặt Shadow: Đậm hơn và nổi bật hơn
            ctx.shadowColor = 'rgba(0, 0, 0, 1)'; // Shadow màu đen đậm
            ctx.shadowBlur = 15; // Tăng độ mờ
            ctx.shadowOffsetX = 3;
            ctx.shadowOffsetY = 3;
            
            ctx.fillStyle = 'white';
            ctx.textBaseline = 'alphabetic'; 

            // ------------------------------------------
            // A. VẼ PHẦN THỜI GIAN VÀ NGÀY/THỨ (Góc dưới trái)
            // ------------------------------------------
            
            // 1. VẼ THỜI GIAN LỚN (VD: 12:26)
            ctx.font = `bold 160px 'Arial', sans-serif`; // Font lớn và đậm
            ctx.letterSpacing = '-3px'; // Giảm khoảng cách chữ
            ctx.textAlign = 'left';
            
            // Vị trí Y cho thời gian: Đặt thời gian lên cao hơn một chút so với địa chỉ
            const TIME_Y = TARGET_HEIGHT - PADDING_BOTTOM - 180; 
            ctx.fillText(timePart, PADDING_X, TIME_Y);
            
            // Đo chiều rộng của giờ để đặt ngày/thứ ngay cạnh
            const timeWidth = ctx.measureText(timePart).width;
            
            // Vị trí X bắt đầu cho Ngày/Thứ (ngay cạnh giờ)
            const DATE_DAY_X = PADDING_X + timeWidth + 40; 

            // 2. VẼ NGÀY VÀ THỨ (Bên phải giờ)
            ctx.font = `20px 'Arial', sans-serif`; // Font nhỏ hơn cho ngày
            ctx.letterSpacing = 'normal';
            
            // Dòng Ngày (01 Oct, 2025): Căn giữa dọc theo phần số lớn của giờ
            const DATE_Y = TIME_Y - 90; 
            ctx.fillText(datePart, DATE_DAY_X, DATE_Y);
            
            // Dòng Thứ (Wed): Dưới Ngày một chút
            const DAY_Y = DATE_Y + 30; 
            ctx.fillText(dayPart, DATE_DAY_X, DAY_Y);
            
            // ------------------------------------------
            // B. VẼ ĐỊA CHỈ (Góc dưới trái, dưới thời gian)
            // ------------------------------------------
            ctx.font = `24px 'Arial', sans-serif`; 
            ctx.letterSpacing = 'normal';
            const ADDRESS_Y = TARGET_HEIGHT - PADDING_BOTTOM; 
            ctx.fillText(addressText, PADDING_X, ADDRESS_Y);


            // ------------------------------------------
            // C. VẼ LOGO/WATERMARK (Góc dưới phải)
            // ------------------------------------------
            ctx.textAlign = 'right';
            
            // 1. VẼ CHỮ LOGO LỚN (TimeMark)
            ctx.font = `bold 30px 'Arial', sans-serif`;
            const LOGO_Y = TARGET_HEIGHT - PADDING_BOTTOM - 40; // Đặt lên cao hơn địa chỉ
            ctx.fillText(logoTextLine1, TARGET_WIDTH - PADDING_X, LOGO_Y);
            
            // 2. VẼ DÒNG CHỮ NHỎ (100% Chân thực)
            ctx.font = `24px 'Arial', sans-serif`;
            const AUTH_Y = TARGET_HEIGHT - PADDING_BOTTOM; // Căn thẳng hàng với Địa chỉ
            ctx.fillText(logoTextLine2, TARGET_WIDTH - PADDING_X, AUTH_Y);

            // --- KẾT THÚC VẼ ---
            ctx.shadowBlur = 0;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
            ctx.letterSpacing = 'normal';

            // Cập nhật link tải về
            const dataURL = canvas.toDataURL('image/png');
            downloadLink.href = dataURL;
            downloadLink.style.display = 'inline-block';
        }
    </script>
</body>
</html>
