<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Công Cụ Chèn TimeMark - Chuẩn 1920x2560</title>
    <style>
        /* --- CSS CƠ BẢN --- */
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            padding: 20px;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- PHẦN INPUT VÀ ĐIỀU KHIỂN --- */
        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            width: 100%;
            max-width: 600px;
        }

        .controls label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
        }

        .controls input[type="text"] {
            width: calc(100% - 10px);
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .controls button {
            margin-top: 20px;
            padding: 10px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .controls button:hover {
            background-color: #0056b3;
        }

        /* --- PHẦN HIỂN THỊ ẢNH/CANVAS --- */
        .image-display {
            width: 100%;
            max-width: 400px; /* Giới hạn kích thước hiển thị trên web */
            text-align: center;
            border: 1px dashed #ccc;
            background-color: #fff;
            padding: 10px;
            border-radius: 8px;
        }
        
        #output-canvas {
            display: none; 
            max-width: 100%;
            height: auto;
            border: 1px solid #ddd;
        }

        #placeholder {
            width: 100%;
            height: 300px;
            line-height: 300px;
            color: #aaa;
            font-size: 1.2em;
        }

        #download-link {
            display: none;
            margin-top: 10px;
            padding: 10px 15px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            text-decoration: none;
            transition: background-color 0.3s;
        }
    </style>
</head>
<body>

    <h1>Công Cụ Chèn TimeMark - Chuẩn 1920x2560</h1>

    <div class="controls">
        <input type="file" id="image-file-input" accept="image/*">
        
        <label for="input-time">Thời gian (VD: 12:26):</label>
        <input type="text" id="input-time" value="12:26">

        <label for="input-date">Ngày (VD: 01 Oct, 2025):</label>
        <input type="text" id="input-date" value="01 Oct, 2025">

        <label for="input-day">Thứ (VD: Wed):</label>
        <input type="text" id="input-day" value="Wed">

        <label for="input-address">Địa chỉ (Góc dưới trái):</label>
        <input type="text" id="input-address" value="ĐT. 356, Đông Hải 2, Hải An, Hải Phòng">

        <button id="process-button">Chèn Thông tin và Xem Ảnh (1920x2560)</button>
        <a id="download-link" href="#" download="timemark_1920x2560.png">Tải Ảnh Đã Chèn Về (PNG)</a>
    </div>

    <div class="image-display">
        <canvas id="output-canvas"></canvas>
        <div id="placeholder">Tải ảnh lên để bắt đầu</div>
    </div>


    <script>
        const fileInput = document.getElementById('image-file-input');
        const canvas = document.getElementById('output-canvas');
        const ctx = canvas.getContext('2d');
        const placeholder = document.getElementById('placeholder');
        const processButton = document.getElementById('process-button');
        const downloadLink = document.getElementById('download-link');
        
        let originalImage = null;
        
        // Kích thước chuẩn hóa
        const TARGET_WIDTH = 1920;
        const TARGET_HEIGHT = 2560;

        // Bắt sự kiện tải file
        fileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    originalImage = new Image();
                    originalImage.onload = () => {
                        // Thiết lập kích thước canvas về kích thước chuẩn hóa
                        canvas.width = TARGET_WIDTH;
                        canvas.height = TARGET_HEIGHT;

                        placeholder.style.display = 'none';
                        canvas.style.display = 'block';
                        
                        processButton.disabled = false;
                        
                        // Vẽ ảnh gốc (đã resize) lên canvas
                        drawCanvas();
                    };
                    originalImage.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // Xử lý nút Chèn
        processButton.addEventListener('click', drawCanvas);

        function drawCanvas() {
            if (!originalImage) return;

            // 1. Vẽ lại ảnh gốc (resize) lên canvas
            // Hàm drawImage(image, dx, dy, dw, dh)
            ctx.drawImage(originalImage, 0, 0, TARGET_WIDTH, TARGET_HEIGHT);

            // 2. Lấy dữ liệu từ ô nhập
            const timePart = document.getElementById('input-time').value.trim() || "12:00";
            const datePart = document.getElementById('input-date').value.trim() || "01 Jan, 2025";
            const dayPart = document.getElementById('input-day').value.trim() || "Wed";
            const addressText = document.getElementById('input-address').value.trim() || "Địa chỉ";
            
            const logoTextLine1 = "TimeMark";
            const logoTextLine2 = "100% Chân thực";

            // --- CÀI ĐẶT THÔNG SỐ VẼ (Dựa trên kích thước 1920x2560) ---
            const PADDING = 70; // Khoảng đệm từ lề dưới và lề trái/phải
            
            // Thiết lập đổ bóng chữ (Text Shadow) giống ảnh mẫu
            ctx.shadowColor = 'rgba(0, 0, 0, 0.7)';
            ctx.shadowBlur = 10;
            ctx.shadowOffsetX = 3;
            ctx.shadowOffsetY = 3;
            
            ctx.fillStyle = 'white';
            ctx.textBaseline = 'alphabetic'; 

            // ------------------------------------------
            // A. VẼ PHẦN THỜI GIAN VÀ NGÀY/THỨ (Góc dưới trái)
            // ------------------------------------------
            
            // Tọa độ Y ban đầu cho nhóm văn bản lớn (tính từ trên xuống)
            const BASE_Y = TARGET_HEIGHT - PADDING;
            
            // 1. VẼ THỜI GIAN LỚN (VD: 12:26)
            ctx.font = `bold 160px 'Helvetica Neue', Arial, sans-serif`; // Kích thước và độ đậm giống ảnh
            ctx.letterSpacing = '-3px'; // Giảm khoảng cách chữ cho font đậm
            ctx.textAlign = 'left';
            
            const timeY = BASE_Y - 200; // Đẩy lên cao hơn
            ctx.fillText(timePart, PADDING, timeY);
            
            // Đo chiều rộng của giờ để đặt ngày/thứ
            const timeWidth = ctx.measureText(timePart).width;

            // 2. VẼ NGÀY VÀ THỨ (Bên phải giờ)
            ctx.font = `18px 'Helvetica Neue', Arial, sans-serif`;
            ctx.letterSpacing = 'normal'; // Reset letter-spacing

            // Dòng Ngày (01 Oct, 2025)
            const dateY = timeY - 90; // Vị trí Y căn giữa theo giờ
            ctx.fillText(datePart, PADDING + timeWidth + 40, dateY);
            
            // Dòng Thứ (Wed)
            const dayY = dateY + 30; // Dưới Ngày một khoảng
            ctx.fillText(dayPart, PADDING + timeWidth + 40, dayY);
            
            // ------------------------------------------
            // B. VẼ ĐỊA CHỈ (Góc dưới trái, dưới thời gian)
            // ------------------------------------------
            ctx.font = `24px 'Helvetica Neue', Arial, sans-serif`; // Kích thước địa chỉ
            const addressY = BASE_Y; 
            ctx.fillText(addressText, PADDING, addressY);


            // ------------------------------------------
            // C. VẼ LOGO/WATERMARK (Góc dưới phải)
            // ------------------------------------------
            ctx.textAlign = 'right';
            
            // 1. VẼ CHỮ LOGO LỚN (TimeMark)
            ctx.font = `bold 30px 'Helvetica Neue', Arial, sans-serif`;
            const logoY = BASE_Y - 40; 
            ctx.fillText(logoTextLine1, TARGET_WIDTH - PADDING, logoY);
            
            // 2. VẼ DÒNG CHỮ NHỎ (100% Chân thực)
            ctx.font = `24px 'Helvetica Neue', Arial, sans-serif`;
            const authenticityY = BASE_Y; 
            ctx.fillText(logoTextLine2, TARGET_WIDTH - PADDING, authenticityY);

            // --- KẾT THÚC VẼ ---
            // Xóa Shadow và Reset
            ctx.shadowBlur = 0;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
            ctx.letterSpacing = 'normal';

            // Cập nhật link tải về
            const dataURL = canvas.toDataURL('image/png');
            downloadLink.href = dataURL;
            downloadLink.style.display = 'inline-block';
        }
    </script>
</body>
</html>
